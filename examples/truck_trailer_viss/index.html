<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.103.1" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/hierarchical_information_model/images/fav.png" type="image/x-icon" />

    <title>Truck and trailer trees used in VISS access scenario :: Commercial Vehicle Information Specifications (CVIS)</title>

    
    <link href="/commercial-vehicle-information-specifications/css/nucleus.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/fontawesome-all.min.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/hybrid.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/featherlight.min.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/perfect-scrollbar.min.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/auto-complete.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/atom-one-dark-reasonable.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/theme.css?1763380096" rel="stylesheet">
    <link href="/commercial-vehicle-information-specifications/css/hugo-theme.css?1763380096" rel="stylesheet">
    
    <link href="/commercial-vehicle-information-specifications/css/theme-blue.css?1763380096" rel="stylesheet">
    
    

    <script src="/commercial-vehicle-information-specifications/js/jquery-3.3.1.min.js?1763380096"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/commercial-vehicle-information-specifications/examples/truck_trailer_viss/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://covesa.github.io/commercial-vehicle-information-specifications/">
  <img src="/commercial-vehicle-information-specifications/images/cvis.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/commercial-vehicle-information-specifications/js/lunr.min.js?1763380096"></script>
<script type="text/javascript" src="/commercial-vehicle-information-specifications/js/auto-complete.js?1763380096"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/covesa.github.io\/commercial-vehicle-information-specifications\/";
    
</script>
<script type="text/javascript" src="/commercial-vehicle-information-specifications/js/search.js?1763380096"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/examples/" title="Examples" class="dd-item
        parent
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/examples/">
          Examples
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/examples/truck_trailer_viss/" title="Truck and trailer trees used in VISS access scenario" class="dd-item
        
        active
        
        ">
      <a href="/commercial-vehicle-information-specifications/examples/truck_trailer_viss/">
          Truck and trailer trees used in VISS access scenario
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/tools/" title="CVIS Tools" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/tools/">
          CVIS Tools
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/tools/him_configurator/" title="HIM configurator" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/tools/him_configurator/">
          HIM configurator
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/tools/vspecpreprocessor/" title="vspecPreprocessor" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/tools/vspecpreprocessor/">
          vspecPreprocessor
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/trees/" title="CVIS vspec trees" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/trees/">
          CVIS vspec trees
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/trees/bus_tree/" title="Bus tree" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/trees/bus_tree/">
          Bus tree
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/trees/car_tree/" title="Car tree" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/trees/car_tree/">
          Car tree
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/trees/driver_tree/" title="Driver tree" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/trees/driver_tree/">
          Driver tree
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/trees/trailer_tree/" title="Trailer tree" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/trees/trailer_tree/">
          Trailer tree
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/commercial-vehicle-information-specifications/trees/truck_tree/" title="Truck tree" class="dd-item
        
        
        
        ">
      <a href="/commercial-vehicle-information-specifications/trees/truck_tree/">
          Truck tree
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/covesa/commercial-vehicle-information-specifications"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/covesa/commercial-vehicle-information-specifications/edit/master/docs/docs-gen/content/examples/truck_trailer_viss/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/commercial-vehicle-information-specifications/'>Commercial Vehicle Information Specifications</a> > <a href='/commercial-vehicle-information-specifications/examples/'>Examples</a> > Truck and trailer trees used in VISS access scenario
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        



	<h2 id="creation-of-truck-and-trailer-trees-that-are-used-in-a-client-server-scenario-using-viss-as-the-interface">Creation of truck and trailer trees that are used in a client-server scenario using VISS as the interface</h2>
<p>The following describes how a demo can be set up in which a client can read and write signals from a truck and a trailer that is connected to it using the VISS interface.<br>
The two repos that are needed for this are the <a href="https://github.com/COVESA/commercial-vehicle-information-specifications">CVIS</a>
and the <a href="https://github.com/COVESA/vissr">VISSR</a> repos, so start with cloning these if not done earlier.<br>
$ git clone <a href="https://github.com/COVESA/commercial-vehicle-information-specifications.git">https://github.com/COVESA/commercial-vehicle-information-specifications.git</a><br>
$ git clone <a href="https://github.com/COVESA/vissr.git">https://github.com/COVESA/vissr.git</a><br>
The database that VISSR is configured to use must be installed on the computer. Redis is the default configuration.<br>
Please see the docmentation of respective database for how to install if that is needed.</p>
<p>The vspecPreprocessor creates an overlay file that is then used together with a suitable vspec domain tree in a call to the VSS-tools exporter.
To set up the environment required by the VSS-tools exporter the Python virtual environment, venv, must be activated.
Assuming that venv is installed, if not please check <a href="/commercial-vehicle-information-specifications/tools/vspecpreprocessor/#initializing-the-python-virtual-environment">here</a>,
the following command can be applied.<br>
$ source venv.sh startme<br>
Venv can when not needed anymore be deactivated by the command:<br>
(.venv)$ deactivate</p>
<p>The vspec tree for trucks in the CVIS/spec/trees/Vehicle/Truck directory,
and the vspec tree for separate trailer trees in the CVIS/spec/trees/Vehicle/Trailer directory will be used.
These trees are not yet complete signal reprensentations for trucks and trailers but as it is what we have available at this point let us use them.
The vspecPreprocessor and the VSS-tools exporter will be used to generate binary format representations of the two trees as shown below.
To generate the trailer overlay file apply the command:</p>
<p>$ python3 vspecPreprocessor.py -i Config/Trailer/vehicleConfig-separateTrailer.json -o Config/Trailer/separateTrailer.vspec -s Config/Trailer/configScope-separateTrailer.json -v Vehicle/Trailer/SeparateTrailerSignalSpecification.vspec</p>
<p>Then to generate the trailer binary file apply the command:</p>
<p>$ vspec export binary -u Vehicle/Trailer/units.yaml -q Vehicle/Trailer/quantities.yaml -l Config/Trailer/separateTrailer.vspec -s Vehicle/Trailer/SeparateTrailerSignalSpecification.vspec -o Trailer.binary</p>
<p>The binary tree is then found in CVIS/spec/trees with the file name Trailer.binary.<br>
To generate the truck binary tree apply the two commands below:\</p>
<p>$ python3 vspecPreprocessor.py -i Config/Truck/vehicleConfig-truck.json -o Config/Truck/truck.vspec -s Config/Truck/configScope.json -v Vehicle/Truck/TruckSignalSpecification.vspec</p>
<p>vspec export binary -u Vehicle/Truck/units.yaml -q Vehicle/Truck/quantities.yaml -l Config/Truck/truck.vspec -s Vehicle/Truck/TruckSignalSpecification.vspec -o Truck.binary</p>
<p>The binary tree is then found in CVIS/spec/trees with the file name Truck.binary.<br>
If human readable YAML trees are desired for inspection, exchange &lsquo;binary&rsquo; in the vspec commands above to &lsquo;yaml&rsquo; (in both exporter format and output file extension).\</p>
<p>The binary format is the format that the VISSR server expects the trees to have.
The directory VISSR/server/vissv2server/forest is the local repository for trees so copy the two files Truck.binary and Trailer.binary there.
$ cp  <!-- raw HTML omitted -->/CVIS/spec/trees/Truck.binary <!-- raw HTML omitted -->/VISSR/server/vissv2server/forest/Truck.binary<br>
$ cp  <!-- raw HTML omitted -->/CVIS/spec/trees/Trailer.binary <!-- raw HTML omitted -->/VISSR/server/vissv2server/forest/Trailer.binary<br>
<!-- raw HTML omitted --> is to be replaced with the path on your device to the VISSR and CVIS root directories.</p>
<p>If you for some reason failed in creating the binary trees using the HIM configurator there are copies available in the CVIS/demodata directory.</p>
<p>For the VISSR server to register the binary trees at startup the file VISSR/server/vissv2server/viss.him must be modified to contain the information for
these trees. The file CVIS/demodata/viss.him is configured or this, so it can be copied to the VISSR/server/vissv2server directory.
If you do not want the viss.him file that is in this directory to be overwritten it needs to be renamed before the copy operation.</p>
<p>To enable a demo where a client can access dynamically changing signal values the feeder needs to be configured for this.
The feder implementation in vissr/feeder/feeder-template/feederv3 can be started with a CLI parameter &ldquo;-i truck-trailer-sim.json&rdquo;
where the file truck-trailer-sim.json contains the simulated signal data.
More about configuring the simulation can be found <a href="https://covesa.github.io/vissr/feeder/#simulated-vehicle-data-sources">here</a>.
A minimal simulation file truck-trailer-sim.json is available in the CVIS/demodata directory.
This file can easily be extended with more signals and more samples per signal.
Copy that file to vissr/feeder/feeder-template/feederv3.</p>
<p>To start the VISSR server and feeder copy the bash shell file CVIS/demodata/runtrucktrailer.sh to the VISSR directory.
The command below will then start them using the mentioned simulator input to the feeder.<br>
$ ./runtrucktrailer.sh startme</p>
<p>What is needed now is a client that can be used to issue requests for truck or trailer signals to the server.
Teh VISSR repo has a number of clients in the VISSR/client/client-1.0 directories that can be used,
either as is or as a code template to be modified.<br>
The VISSR/client/client-1.0/Javascript/wsclient.html that uses the Websocket protocol can be used directly, by clicking on the file it will open in the browser.
Start to enter the IP address of the server into the uppermost field and click on the Server IP button.
If the server has the same IP address as this client then &ldquo;localhost&rdquo; can be written into the field instead.<br>
Now request messages can be copied into the field below followed by clicking on the Send button and the responses from the server will be shown below in the browser tab.
Below is shown a few requests that can be used.</p>
<pre tabindex="0"><code>{&#34;action&#34;:&#34;get&#34;,&#34;path&#34;:&#34;Vehicle.TraveledDistance&#34;,&#34;requestId&#34;:&#34;232&#34;}
{&#34;action&#34;:&#34;get&#34;,&#34;path&#34;:&#34;Vehicle.CurrentLocation&#34;,&#34;filter&#34;:{&#34;variant&#34;:&#34;paths&#34;,&#34;parameter&#34;:[&#34;Longitude&#34;,&#34;Latitude&#34;]},&#34;requestId&#34;:&#34;237&#34;}
{&#34;action&#34;:&#34;subscribe&#34;,&#34;path&#34;:&#34;Trailer1.Chassis.Axle.Row1.Wheel.Pos7.Tire.Temperature&#34;,&#34;filter&#34;:{&#34;variant&#34;:&#34;timebased&#34;,&#34;parameter&#34;:{&#34;period&#34;:&#34;1000&#34;}},&#34;requestId&#34;:&#34;246&#34;}
{&#34;action&#34;:&#34;unsubscribe&#34;,&#34;subscriptionId&#34;:&#34;1&#34;,&#34;requestId&#34;:&#34;240&#34;}
</code></pre><p>Other websocket request examples can be found in VISSR/client/client-1.0/Javascript/appclient_commands.txt that can be modified to signal paths used in this demo.</p>
<p>To simulate that one more trailer is towed by the truck the steps below can be followed.<br>
Issue a command to stop the server and feeder:<br>
$ ./runtrucktrailer.sh stopme</p>
<h3 id="add-one-more-trailer-tree">Add one more trailer tree.</h3>
<p>This can be done by first creating another trailer binary tree using the HIM configurator,
but a shortcut is possible by using the same binary tree as for the first trailer.
To do this add the following rows to the viss.him file:</p>
<pre tabindex="0"><code>HIM.Trailer2:
  type: direct
  domain: Automotive.Trailer.Data
  version: 0.1.0
  local: forest/Trailer.binary
  public: https://github.com/COVESA/commercial-vehicle-information-specifications/tree/main/spec/trees/Vehicle/Trailer
  description: A tree for the second trailer in the train.
</code></pre><p>The snippet above can be inserted at the top or at the bottom, or in between any two tree declarations.<br>
To get back any values from get requests to Trailer2 the truck-trailer-sim.json file needs to be updated with that.<br>
Then restart the server and feeder:<br>
$ ./runtrucktrailer.sh startme<br>
Signal data from the new trailer can now be accessed using requests with paths having Trailer2 as the root node name (the first segment name in the path).</p>
<p>The VISSR server supports &lsquo;forest inquiry&rsquo; requests as shown below.
This is not part of the VISSv3.0 spec but may become part of a next version.</p>
<pre tabindex="0"><code>{&#34;action&#34;:&#34;get&#34;, &#34;path&#34;:&#34;HIM&#34;, &#34;filter&#34;:{&#34;variant&#34;:&#34;metadata&#34;, &#34;parameter&#34;:&#34;0&#34;}, &#34;requestId&#34;:&#34;1957&#34;}
</code></pre><p>The response will contain the metadata from the viss.him file in JSON format,
except the &rsquo;local&rsquo; property that is excluded as it is server internal data.</p>
<p>The browser tab rendered by wsclient.html may look something like below, depending on which requests that have been issued to the server.
<img src="/commercial-vehicle-information-specifications/images/ws-client-screenshot.png" alt="VISSR tech stack"></p>





<footer class=" footline" >
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/commercial-vehicle-information-specifications/examples/" title="Examples"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/commercial-vehicle-information-specifications/tools/" title="CVIS Tools" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/commercial-vehicle-information-specifications/js/clipboard.min.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/perfect-scrollbar.min.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/perfect-scrollbar.jquery.min.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/jquery.sticky.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/featherlight.min.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/highlight.pack.js?1763380096"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/commercial-vehicle-information-specifications/js/modernizr.custom-3.6.0.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/learn.js?1763380096"></script>
    <script src="/commercial-vehicle-information-specifications/js/hugo-learn.js?1763380096"></script>
    
        
            <script src="/commercial-vehicle-information-specifications/mermaid/mermaid.js?1763380096"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
